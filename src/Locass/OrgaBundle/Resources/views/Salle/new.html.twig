{% extends 'LocassOrgaBundle::layout.html.twig' %}
{% block orga_stylesheet_relatedplug %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset ('intl-tel-input/build/css/intlTelInput.css') }}">
    <link rel="stylesheet" href="{{ asset ('EasyAutocomplete/easy-autocomplete.min.css') }}">
    <link rel="stylesheet" href="{{ asset ('EasyAutocomplete/easy-autocomplete.themes.min.css') }}">
    <style type="text/css">
        .iti-flag {
            background-image: url("{{ asset ('intl-tel-input/build/img/flags.png') }}");
        }
        .country-list {
            background-color: darkred !important;
        }
    </style>
{% endblock orga_stylesheet_relatedplug %}
{% block orga_content %}
    <!-- RIBBON -->
    <div id="ribbon">

                        <span class="ribbon-button-alignment">
                            <span id="refresh" class="btn btn-ribbon" data-action="resetWidgets" data-title="refresh"  rel="tooltip" data-placement="bottom" data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings." data-html="true">
                                <i class="fa fa-refresh"></i>
                            </span>
                        </span>

        <!-- breadcrumb -->
        <ol class="breadcrumb">
            <li>Salles</li><li>Ajout d'une Salle dans mes projets </li>
        </ol>
        <!-- end breadcrumb -->

        <!-- You can also add more buttons to the
        ribbon for further usability

        Example below:

        <span class="ribbon-button-alignment pull-right">
        <span id="search" class="btn btn-ribbon hidden-xs" data-title="search"><i class="fa-grid"></i> Change Grid</span>
        <span id="add" class="btn btn-ribbon hidden-xs" data-title="add"><i class="fa-plus"></i> Add</span>
        <span id="search" class="btn btn-ribbon" data-title="search"><i class="fa-search"></i> <span class="hidden-mobile">Search</span></span>
        </span> -->

    </div>
    <!-- END RIBBON -->

    <!-- MAIN CONTENT -->
    <div id="content">

        <div class="row">
            <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
                <h1 class="page-title txt-color-blueDark"><i class="fa-fw fa fa-map-marker"></i> Salles <span>> Ajout d'une salle dans mes projets</span></h1>
            </div>
            <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
                <ul id="sparks" class="">
                    <li class="sparks-info">
                        <h5> My Income <span class="txt-color-blue">$47,171</span></h5>
                        <div class="sparkline txt-color-blue hidden-mobile hidden-md hidden-sm">
                            1300, 1877, 2500, 2577, 2000, 2100, 3000, 2700, 3631, 2471, 2700, 3631, 2471
                        </div>
                    </li>
                    <li class="sparks-info">
                        <h5> Site Traffic <span class="txt-color-purple"><i class="fa fa-arrow-circle-up"></i>&nbsp;45%</span></h5>
                        <div class="sparkline txt-color-purple hidden-mobile hidden-md hidden-sm">
                            110,150,300,130,400,240,220,310,220,300, 270, 210
                        </div>
                    </li>
                    <li class="sparks-info">
                        <h5> Site Orders <span class="txt-color-greenDark"><i class="fa fa-shopping-cart"></i>&nbsp;2447</span></h5>
                        <div class="sparkline txt-color-greenDark hidden-mobile hidden-md hidden-sm">
                            110,150,300,130,400,240,220,310,220,300, 270, 210
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- widget grid -->
        <section id="widget-grid" class="">

            <!-- row -->
            <div class="row">
                <!-- NEW COL START -->
                <article class="col-sm-12 col-md-12 col-lg-6">
                    <!-- Widget ID (each widget will need unique ID)-->
                    <div class="jarviswidget" id="wid-id-1" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-collapsed="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
                        <!-- widget options:
                            usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                            data-widget-colorbutton="false"
                            data-widget-editbutton="false"
                            data-widget-togglebutton="false"
                            data-widget-deletebutton="false"
                            data-widget-fullscreenbutton="false"
                            data-widget-custombutton="false"
                            data-widget-collapsed="true"
                            data-widget-sortable="false"

                        -->
                        <header>
                            <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                            <h2>Ajout d'une Salle</h2>

                        </header>

                        <!-- widget div-->
                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>
                            <!-- end widget edit box -->

                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <form action="{{ path('locass_orga_homepage') }}" id="checkout-form" method="post" class="smart-form" novalidate="novalidate">

                                    <fieldset>
                                        <section>
                                            <label class="input">
                                                <input type="text" name="society" id="society" placeholder="Nom de la Salle">
                                            </label>
                                        </section>
                                        <div class="row">
                                            <section class="col col-4">
                                                <p id="output">Téléphone: </p><br>
                                                <div class="form-group">
                                                    <label class="input">
                                                        <input type="tel" name="phoneenter" id="phone">
                                                    </label>
                                                </div>
                                            </section>
                                            <section class="col col-6">
                                                <p id="output">Email: </p><br>
                                                <div class="form-group">
                                                    <label class="input"> <i class="icon-append fa fa-envelope-o"></i>
                                                        <input type="email" name="email" id="email">
                                                    </label>
                                                </div>
                                            </section>
                                            <section class="col col-6">
                                                <input id="output2" type="hidden" name="phone">
                                            </section>

                                        </div>


                                    </fieldset>

                                    <fieldset>
                                        <div>

                                            <section>
                                                <label for="autocomplete" class="input">
                                                    <input type="text" name="adresse" id="autocomplete" onFocus="geolocate()" placeholder="Adresse Complète.......">
                                                </label>
                                            </section>


                                        </div>
                                        <div class="row">
                                            <section class="col col-2">
                                                <label class="input">
                                                    <input type="hidden" name="numrue" placeholder="N° - AUTO" id="street_number">
                                                </label>
                                            </section>

                                            <section class="col col-10">
                                                <label class="input">
                                                    <input type="hidden" name="rue" placeholder="Rue - AUTO" id="route">
                                                </label>

                                            </section>

                                        </div>
                                        <div class="row">
                                            <section class="col col-2">
                                                <label class="input">
                                                    <input type="hidden" name="codpost" placeholder="CP - AUTO" id="postal_code">
                                                </label>
                                            </section>

                                            <section class="col col-10">
                                                <label class="input">
                                                    <input type="hidden" name="ville" placeholder="Ville - AUTO" id="locality">
                                                </label>
                                            </section>

                                        </div>
                                        <div class="row">
                                            <section class="col col-4">
                                                <label class="input">
                                                    <input type="hidden" name="region" placeholder="Région - AUTO" id="administrative_area_level_1">
                                                </label>
                                            </section>

                                            <section class="col col-6">
                                                <label class="input">
                                                    <input type="hidden" name="pays" placeholder="Pays - AUTO" id="country">
                                                </label>
                                            </section>
                                            <section class="col col-2">
                                                <label class="input">
                                                    <input type="hidden" name="payscode" placeholder="PaysCode - AUTO" id="country_code">
                                                </label>
                                            </section>

                                        </div>
                                        <div class="row">
                                            <section class="col col-6">
                                                <label class="input"> <p class="hide" id="lati">Latitude: </p>
                                                    <input type="text" name="latitude" id="lat" placeholder="latitude - AUTO">
                                                </label>
                                            </section>


                                            <section class="col col-6">
                                                <label class="input"> <p class="hide" id="long">Longitude: </p>
                                                    <input type="text" name="longitude" id="lng" placeholder="longitude - AUTO">
                                                </label>
                                            </section>

                                        </div>
                                        <div class="row">

                                        </div>
                                    </fieldset>
                                    <fieldset>
                                        <section>
                                            <label class="textarea">
                                                <textarea rows="3" name="notes" placeholder="Info Description...."></textarea>
                                            </label>
                                        </section>
                                    </fieldset>
                                    <fieldset>
                                        <div class="row">
                                            <section class="col col-6">
                                                <p id="output">Contact: </p>
                                            </section>

                                        </div>
                                        <div class="row">
                                            <section class="col col-6">

                                                <label class="input"> <i class="icon-prepend fa fa-user"></i>
                                                    <input type="text" name="nom" placeholder="First name">
                                                </label>
                                            </section>
                                            <section class="col col-6">
                                                <label class="input"> <i class="icon-prepend fa fa-user"></i>
                                                    <input type="text" name="prenom" placeholder="Last name">
                                                </label>
                                            </section>
                                        </div>
                                    </fieldset>


                                    <footer>
                                        <button type="submit" class="btn btn-primary">
                                            Validate Form
                                        </button>
                                    </footer>
                                </form>

                            </div>
                            <!-- end widget content -->

                        </div>
                        <!-- end widget div -->

                    </div>
                    <!-- end widget -->

                </article>
                <article class="col-sm-12 col-md-12 col-lg-6">
                    <div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-collapsed="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
                        <!-- widget options:
                        usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                        data-widget-colorbutton="false"
                        data-widget-editbutton="false"
                        data-widget-togglebutton="false"
                        data-widget-deletebutton="false"
                        data-widget-fullscreenbutton="false"
                        data-widget-custombutton="false"
                        data-widget-collapsed="true"
                        data-widget-sortable="false"

                        -->
                        <header>
                            <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                            <h2>Mes Salles enregistrées </h2>

                        </header>

                        <!-- widget div-->
                        <div>

                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->

                            </div>
                            <!-- end widget edit box -->

                            <!-- widget content -->
                            <div class="widget-body no-padding">

                                <table id="dt_basic" class="table table-striped table-bordered table-hover" width="100%">
                                    <thead>
                                    <tr>
                                        <th>Salle</th>
                                        <th>Ville</th>
                                        <th>Pays</th>
                                        <th>Infos</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>

                            </div>
                            <!-- end widget content -->

                        </div>
                        <!-- end widget div -->

                    </div>
                </article>

            </div>
            <!-- END MAIN CONTENT -->

        </section>
        <!-- end widget grid -->

    </div>
    <!-- END MAIN CONTENT -->
{% endblock orga_content %}

{% block orga_content_relatedplug %}
    <script src="{{ asset ('intl-tel-input/build/js/intlTelInput.js') }}"></script>
    <script src="{{ asset ('EasyAutocomplete/jquery.easy-autocomplete.min.js') }}"></script>
{% endblock orga_content_relatedplug %}

{% block orga_content_relatedscript %}
    <script>
        $(document).ready(function() {

            /* DO NOT REMOVE : GLOBAL FUNCTIONS!
             *
             * pageSetUp(); WILL CALL THE FOLLOWING FUNCTIONS
             *
             * // activate tooltips
             * $("[rel=tooltip]").tooltip();
             *
             * // activate popovers
             * $("[rel=popover]").popover();
             *
             * // activate popovers with hover states
             * $("[rel=popover-hover]").popover({ trigger: "hover" });
             *
             * // activate inline charts
             * runAllCharts();
             *
             * // setup widgets
             * setup_widgets_desktop();
             *
             * // run form elements
             * runAllForms();
             *
             ********************************
             *
             * pageSetUp() is needed whenever you load a page.
             * It initializes and checks for all basic elements of the page
             * and makes rendering easier.
             *
             */

            pageSetUp();

            var optionsAutoComplete = {
                url: function(phrase) {
                    return "{{ resturl }}/localpitsymf/orga/newsalle/searchsalles?nom=" + phrase;
                },

                getValue: "nom",

                template: {
                    type: "custom",
                    method: function(value, item) {
                        return "<span class='flag flag-" + (item.payscode).toLowerCase() + "' ></span> " + value + " <span>- " + (item.ville) + "</span>";
                    }
                },


                theme: "dark",
                list: {
                    maxNumberOfElements: 20,
                    match: {
                        enabled: true
                    }
                }
            };

            $("#society").easyAutocomplete(optionsAutoComplete);

            $.ajax({
                url: "{{ resturl }}/localpitsymf/orga/newsalle/sallesinscrite/{{ app.user.idmongo }}",
                method: "GET",
                success: function(response){
                    var searchsalle = response[0].salles;
                    if (!searchsalle){
                        console.log ("pas d'enregistrements");

                    }
                    else {
                        var tbody = $('#dt_basic tbody'),
                            props = ["society", "ville", "pays", "notes"];
                        $.each(searchsalle, function(i, dt_basic) {
                            var tr = $('<tr>');
                            $.each(props, function(i, prop) {
                                $('<td>').html(dt_basic[prop]).appendTo(tr);
                            });
                            tbody.append(tr);
                        });
                    }


                }
            });

            /*
             * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
             * eg alert("my home function");
             *
             * var pagefunction = function() {
             *   ...
             * }
             * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
             *
             * TO LOAD A SCRIPT:
             * var pagefunction = function (){
             *  loadScript(".../plugin.js", run_after_loaded);
             * }
             *
             * OR
             *
             * loadScript(".../plugin.js", run_after_loaded);
             */
            var input = $("#phone"),
                output = $("#output");

            var reset = function() {
                input.removeClass("error");
            };




            input.intlTelInput({
                initialCountry: "auto",
                geoIpLookup: function(callback) {
                    $.get('http://ipinfo.io', function() {}, "jsonp").always(function(resp) {
                        var countryCode = (resp && resp.country) ? resp.country : "";
                        callback(countryCode);
                    });
                },
                utilsScript: "{{ asset ('intl-tel-input/build/js/utils.js') }}" // just for formatting/placeholders etc
            });
            input.on("keyup change", function() {
                var intlNumber = input.intlTelInput("getNumber");
                if (intlNumber) {
                    output.text("International: " + intlNumber);
                    document.getElementById("output2").value = intlNumber;
                } else {
                    output.text("Téléphone:");
                }
            });

            // on blur: validate
            input.blur(function() {
                reset();
                if ($.trim(input.val())) {
                    if (input.intlTelInput("isValidNumber")) {

                    } else {
                        input.addClass("error");
                        output.text("Invalid number");
                        document.getElementById("phone").value = null;
                    }
                }
            });
            // on keyup / change flag: reset
            input.on("keyup change", reset);

            $("#spinner").spinner({
                min: 1
            });
            var errorClass = 'invalid';
            var errorElement = 'em';

            var $checkoutForm = $('#checkout-form').validate({
                errorClass		: errorClass,
                errorElement	: errorElement,
                highlight: function(element) {
                    $(element).parent().removeClass('state-success').addClass("state-error");
                    $(element).removeClass('valid');
                },
                unhighlight: function(element) {
                    $(element).parent().removeClass("state-error").addClass('state-success');
                    $(element).addClass('valid');
                },

                // Rules for form validation
                rules : {
                    society : {
                        required : true
                    },
                    notes : {
                        required : true
                    },
                    adresse : {
                        required : true
                    },
                    rue : {
                        required : true
                    },
                    pays : {
                        required : true
                    },
                    ville : {
                        required : true
                    },
                    codpost : {
                        required : true
                    },
                    numrue : {
                        required : true
                    },
                    region : {
                        required : true
                    },
                    organame : {
                        required : true
                    },
                    latitude : {
                        required : true
                    },
                    longitude : {
                        required : true
                    }
                },

                // Messages for form validation
                messages : {
                    society : {
                        required : 'Please enter company name'
                    },
                    notes : {
                        required : 'Please enter your description'
                    },
                    adresse : {
                        required : 'Please enter your full address'
                    },
                    rue : {
                        required : 'Invalid Adress'
                    },
                    pays : {
                        required : 'Invalid Adress'
                    },
                    ville : {
                        required : 'Invalid Adress'
                    },
                    codpost : {
                        required : 'Invalid Adress'
                    },
                    numrue : {
                        required : 'Invalid Adress'
                    },
                    region : {
                        required : 'Invalid Adress'
                    },
                    organame : {
                        required : 'Please enter name organization'
                    },
                    latitude : {
                        required : 'Invalid latitude'
                    },
                    longitude : {
                        required : 'Invalid longitude'
                    }
                },

                // Ajax form submition
                submitHandler : function(form) {
                    $.ajax({
                        url: "{{ resturl }}/localpitsymf/orga/newsalle/ajoutsalle/{{ app.user.idmongo }}",
                        method: "PUT",
                        data: $("#checkout-form").serialize(),
                        success: function(response){
                            window.location.href = "{{ path('locass_orga_salle_new') }}";
                        }
                    });
                },



                // Do not change code below
                errorPlacement : function(error, element) {
                    error.insertAfter(element.parent());
                }
            });





        });

    </script>

{% endblock orga_content_relatedscript %}


{% block orga_content_relatedscript2 %}
    <script>



        var placeSearch, autocomplete;

        var componentForm = {
            street_number: 'short_name',
            route: 'long_name',
            locality: 'long_name',
            administrative_area_level_1: 'short_name',
            country: 'long_name',
            postal_code: 'short_name'
        };

        function initAutocomplete() {
            // Create the autocomplete object, restricting the search to geographical
            // location types.
            autocomplete = new google.maps.places.Autocomplete(
                /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
                {types: ['geocode']});

            // When the user selects an address from the dropdown, populate the address
            // fields in the form.
            autocomplete.addListener('place_changed', fillInAddress);
        }

        // [START region_fillform]
        function fillInAddress() {
            // Get the place details from the autocomplete object.
            var validLng = $("#long");
            var validLat = $("#lati");
            var place = autocomplete.getPlace();

            var lat = place.geometry.location.lat(),
                lng = place.geometry.location.lng();

            document.getElementById("lat").value = lat;
            document.getElementById("lng").value = lng;
            validLng.removeClass("hide");
            validLat.removeClass("hide");

            for (var component in componentForm) {
                document.getElementById(component).value = '';
                document.getElementById(component).disabled = false;
            }

            // Get each component of the address from the place details
            // and fill the corresponding field on the form.
            for (var i = 0; i < place.address_components.length; i++) {
                var addressType = place.address_components[i].types[0];
                if (componentForm[addressType]) {
                    var val = place.address_components[i][componentForm[addressType]];
                    document.getElementById(addressType).value = val;
                }
                if (addressType == "country") {
                    document.getElementById("country_code").value = place.address_components[i].short_name;
                }
            }
        }
        // [END region_fillform]

        // [START region_geolocation]
        // Bias the autocomplete object to the user's geographical location,
        // as supplied by the browser's 'navigator.geolocation' object.
        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var geolocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    var circle = new google.maps.Circle({
                        center: geolocation,
                        radius: position.coords.accuracy
                    });
                    autocomplete.setBounds(circle.getBounds());
                });
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ goapikey }}&signed_in=true&libraries=places&callback=initAutocomplete"
            async defer></script>
{% endblock orga_content_relatedscript2 %}